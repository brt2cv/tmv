UDP-数据远程传输中间件
IP: 103.72.167.230
端口：31610

Version: 2019-10-12-01

<!-- TOC -->

- [1. 消息](#1-消息)
    - [1.1. 结构组成](#11-结构组成)
    - [1.2. 消息类型](#12-消息类型)
- [2. 请求方](#2-请求方)
    - [2.1. 心跳](#21-心跳)
    - [2.2. 注册协助请求](#22-注册协助请求)
    - [2.3. 已获取协助（中间件推送）](#23-已获取协助中间件推送)
    - [2.4. 主动断开连接](#24-主动断开连接)
    - [2.5. 被动中断协助（中间件推送）](#25-被动中断协助中间件推送)
- [3. 协助方](#3-协助方)
    - [3.1. 心跳](#31-心跳)
    - [3.2. 查询协助列表](#32-查询协助列表)
    - [3.3. 连接协助请求](#33-连接协助请求)
    - [3.4. 断开连接](#34-断开连接)
- [4. 异常](#4-异常)

<!-- /TOC -->

# 1. 消息
## 1.1. 结构组成
消息结构组成：Header + Body

消息头固定长度：4bytes；
消息体最大长度：8180bytes；

## 1.2. 消息类型
目前将消息分为4种类型（及其对应的Header）：
- 心跳包
- 错误（异常）消息
- 指令消息
- 数据包

心跳包：
    - Header: (0xa0, 0x3f, 0x3f, 0xa0)
    - Body: Null

错误（异常）消息：
    - Header: (0xa0, 0x3e, 0x3e, 0xa0)
    - Body: 说明

指令消息：
    - Header: (0xa1, 0x3f, 0x3f, 0xa1)
    - Body: Json数据

数据包：
    - Header: (0xa2, 0x3f, 0x3f, 0xa2)
    - Body: 数据内容


# 2. 请求方
## 2.1. 心跳
心跳：客户端 每 1s 主动向通讯中间件发送心跳包，中间件回应；5s未收到心跳或反馈信息则主动断开连接；

## 2.2. 注册协助请求
```
{
    "msg-id": "0102",
    "type": "Register Assist",
    "msg": License-ID
}
```

应答
```
{
    "msg-id": "0102",
    "type": "Register Assist",
    "msg": true/false
}
```

如应答为true，则请求方进入recv()过程，接收传入的数据

## 2.3. 已获取协助（中间件推送）
```
{
    "msg-id": "0102",
    "type": "Request Accept",
}
```

## 2.4. 主动断开连接
中断与通讯中间件的连接。
```
{
    "msg-id": "0102",
    "type": "Connection Shutdown"
}
```

应答
```
{
    "msg-id": "0102",
    "type": "Connection Shutdown"
}
```

## 2.5. 被动中断协助（中间件推送）
```
{
    "msg-id": "0102",
    "type": "Connection Break"
}
```

# 3. 协助方
## 3.1. 心跳
同请求方一样，需要向通讯中间件发送心跳包。

## 3.2. 查询协助列表
```
{
    "msg-id": "0102",
    "type": "Register List",
}
```

应答
```
{
    "msg-id": "0102",
    "type": "Register List",
    "msg":
        {
            "license1": "222.182.100.1:31610",
            "license2": "222.182.100.2:31610",
        }
}
```

## 3.3. 连接协助请求
```
{
    "msg-id": "0102",
    "type": "Connect to Remote",
    "msg": "222.182.100.1:31610"
}
```

应答
```
{
    "msg-id": "0102",
    "type": "Connect to Remote",
    "msg": true/false
}
```

如应答为true，则请求方进入send()过程，发送数据

## 3.4. 断开连接
同上。

# 4. 异常
```
{
    "msg-id": "0102",
    "type": "Exception",
    "msg": "Reasons..."
}
```
